version: "3.9"
services:
  app-service:
    container_name: app-service
    image: vinorelbine/app-service # specify name of image on Docker Hub
    restart: "always" # automatically restart container when server crashes
    environment: # set up environment variables
      AUTH_SERVICE_IP: ${AUTH_SERVICE_IP}
    ports:
      - 8000
    depends_on: # only run app-service after auth-service has started
      auth-service:
        condition: service_started
  auth-service:
    container_name: auth-service
    image: vinorelbine/auth-service
    restart: "always" # automatically restart container when server crashes
    ports:
      - 3000

  nginx:
    image: vinorelbine/app-auth-nginx
    restart: "always"

    ports:
      - 80:80
    volumes:
      - ./nginx/nginx-setup.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - app-service
      - auth-service
